<?xml version="1.0"?>

<!--

 OpenPASL

 LICENSE

 This source file is subject to the new BSD license that is bundled
 with this package in the file LICENSE.txt.

 @copyright  Copyright (c) 2008 Danny Graham, Scott Thundercloud. (http://code.google.com/p/openpasl)
 @license <http://www.opensource.org/licenses/bsd-license.php> New BSD License

 Requirements:

 - PHP 5.1.4
 - Phing 2.2.0
 - PHPDocumentor 1.3.1

 Usage:

   phing [ <options> ] [ <targets> ]

 Options:

   -D<property>={value}
     Override a property in build.properties
-->

<project name="openpasl package builds" default="all" basedir="../">

	<property file="build.properties"/>
	<property file="${path.build}/build.properties"/>

	<target name="all" depends="clean, deb, tar, zip">
	</target>

	<target name="clean">
		<delete dir="${path.tmp.release.archive}" includeemptydirs="true" verbose="true" failonerror="true" />
		<delete verbose="true" failonerror="true">
			<fileset dir="${path.build.release.bin}">
				<include name="**/**"/>
			</fileset>
		</delete>
		<phing phingfile="${path.doc}/build.xml" target="clean"/>
	</target>

	<target name="deb" depends="preflight">
	</target>

	<target name="tar" depends="preflight">
		<tar destfile="${build.bin.tar}">
			<fileset dir="${path.tmp.release.archive}">
				<include name="**/**"/>
			</fileset>
		</tar>
	</target>

	<target name="zip" depends="preflight">
		<zip destfile="${build.bin.zip}">
			<fileset dir="${path.tmp.release.archive}">
				<include name="**/**"/>
			</fileset>
		</zip>
	</target>

	<target name="preflight">

		<!-- Build Docs Fresh -->
		<phing phingfile="${path.doc}/build.xml" target="all"/>

		<!-- Build /tmp target for archives -->
		<mkdir dir="${path.tmp.release.archive}"/>
		<mkdir dir="${path.tmp.release.archive}/doc/api"/>
		<copy todir="${path.tmp.release.archive}">
			<fileset dir="${path.src}">
				<include name="**/**"/>
			</fileset>
		</copy>
		<copy todir="${path.tmp.release.archive}/doc/api">
			<fileset dir="${build.api.release}">
				<include name="**/**"/>
			</fileset>
		</copy>
		<copy file="${project.license}" tofile="${path.tmp.release.archive}/LICENSE.txt"/>
	</target>


</project>